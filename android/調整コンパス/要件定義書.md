# 調整コンパスアプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
建物内など磁気干渉により方位がずれる環境でも、ユーザーが手動で補正できるコンパスアプリを提供する。

### 1.2 対象プラットフォーム
- Android（API Level 21以上を想定）

### 1.3 主要機能
- リアルタイムで方位を表示するコンパス機能
- ユーザーが手動で北の位置を調整できる機能
- 調整したオフセットを保存・ロックする機能

## 2. 機能要件

### 2.1 コンパス表示機能
- **FR-001**: デバイスの磁気センサーと加速度センサーを使用して方位を取得する
- **FR-002**: 取得した方位をリアルタイムでコンパスUIに表示する
- **FR-003**: 北（N）、東（E）、南（S）、西（W）の方向を明確に表示する
- **FR-004**: 現在の方位角（0-360度）を数値で表示する

### 2.2 オフセット調整機能
- **FR-005**: ユーザーが「調整モード」に入れるボタンを提供する
- **FR-006**: 調整モード中は、ユーザーが画面を回転させて正しい北の位置を設定できる
- **FR-007**: 調整中は、現在のオフセット値をリアルタイムで表示する
- **FR-008**: 調整完了後、「ロック」ボタンでオフセットを保存する
- **FR-009**: 保存されたオフセットは次回起動時にも適用される

### 2.3 ロック機能
- **FR-010**: ロック状態では、オフセットが固定され変更できない
- **FR-011**: ロック解除ボタンで再度調整可能にする
- **FR-012**: ロック状態は視覚的に表示する（例：ロックアイコン、色の変更）

### 2.4 リセット機能
- **FR-013**: オフセットを0にリセットするボタンを提供する
- **FR-014**: リセット時は確認ダイアログを表示する

### 2.5 設定保存機能
- **FR-015**: オフセット値はSharedPreferencesに保存する
- **FR-016**: ロック状態も保存する

## 3. 非機能要件

### 3.1 パフォーマンス
- **NFR-001**: コンパス表示は60fps以上で滑らかに動作する
- **NFR-002**: センサー更新は適切な頻度（10-20Hz程度）で行う

### 3.2 ユーザビリティ
- **NFR-003**: 直感的で分かりやすいUIを提供する
- **NFR-004**: 操作は最小限のタップで完了できる
- **NFR-005**: 調整モードと通常モードの違いが明確に分かる
- **NFR-010**: Material Design 3の原則に基づいたシンプルでモダンなデザイン
- **NFR-011**: ダークモードに対応する

### 3.3 互換性
- **NFR-006**: Android 5.0（API Level 21）以上で動作する
- **NFR-007**: 磁気センサーと加速度センサーが利用可能なデバイスで動作する

### 3.4 信頼性
- **NFR-008**: センサーが利用できない場合は適切なエラーメッセージを表示する
- **NFR-009**: アプリクラッシュ時も設定は保持される

## 4. UI要件

### 4.1 デザイン原則
- **シンプルでモダン**: Material Design 3に準拠したデザイン
- **ミニマル**: 必要最小限の要素のみを表示
- **視認性**: 適切なコントラスト比を確保（WCAG AA基準）
- **一貫性**: 統一されたデザイン言語

### 4.2 メイン画面
- **コンパス表示**: 
  - 中央に配置された円形のコンパス（画面幅の80%、最大600dp）
  - シンプルで洗練されたデザイン
  - 滑らかなアニメーション（60fps）
- **方位角表示**: 
  - 画面上部中央に配置
  - 大きなフォント（24sp）で明確に表示
  - 形式: "045°" または "方位: 045°"
- **操作ボタン**: 
  - 画面下部中央に横並び配置（BottomAppBar）
  - Material IconButton（Filled Tonal）スタイル
  - アイコンで直感的に操作可能
  - 調整、ロック/ロック解除、リセットの3つのボタン

### 4.3 調整モード
- **視覚的フィードバック**: 
  - 背景に薄いアクセント色のオーバーレイを表示
  - コンパスを少し薄く表示（透明度90%）
- **オフセット表示**: 
  - Material Chip（Outlined）スタイル
  - 方位角表示の下に配置
  - 形式: "オフセット: +15°" または "-15°"
- **操作**: 
  - 画面を回転させて正しい北を設定
  - ロックボタンで保存

### 4.4 視覚的フィードバック
- **ロック状態**: 
  - ロックボタンのアイコンが`lock`に変わる
  - アクセントカラーで強調表示
  - 他のボタン（調整、リセット）は無効化
- **調整モード**: 
  - 背景色が変わる（薄いアクセント色、透明度10-20%）
  - 調整ボタンがアクティブ状態になる
- **アニメーション**: 
  - すべての状態遷移に滑らかなアニメーション
  - コンパスの回転は`AccelerateDecelerateInterpolator`を使用

### 4.5 カラースキーム
- **プライマリカラー**: 深い青（#1976D2）またはシステムテーマカラー
- **アクセントカラー**: 強調用（#FF6B6B）
- **背景色**: ライト/ダークモード対応
- **テキスト色**: 適切なコントラストを確保

### 4.6 ダークモード対応
- システム設定に従って自動切り替え
- すべての色をダークモード用に調整
- コントラスト比を維持

## 5. 制約事項

### 5.1 技術的制約
- Android標準のSensorManagerを使用
- 磁気センサーと加速度センサーが必須

### 5.2 環境制約
- 磁気干渉の多い環境でも動作する必要がある
- デバイスの向きが変わっても正しい方位を表示

## 6. 将来の拡張機能（オプション）

### 6.1 追加機能候補
- 複数のオフセット設定を保存（場所ごと）
- オフセットの履歴表示
- カスタマイズ可能なコンパスデザイン
- 方位の記録・共有機能

## 7. 用語定義

- **オフセット**: 実際の磁北と表示する北の位置の差（度単位）
- **調整モード**: ユーザーが手動でオフセットを設定するモード
- **ロック**: オフセットを固定し、変更できない状態

