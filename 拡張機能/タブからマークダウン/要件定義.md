# Tab to MD - 要件仕様書

## プロジェクト概要
Chrome拡張機能として、開いている複数のタブのページ内容をマークダウン形式に変換して保存するツール

## 基本要件

### 1. ファイル保存の仕様
- **1ページ = 1ファイル**: 各タブのページは個別のマークダウンファイルとして保存する
- **ファイル名**: ページのタイトルを使用
  - ファイル名として使用できない文字（`< > : " / \ | ? *`）は `_` に置換
  - 80文字以降は削除（切り詰め）
  - 同じタイトルのページがある場合は自動で番号を付与（例: `タイトル_1.md`, `タイトル_2.md`）
- **ファイル形式**: マークダウン（.md）

### 2. 保存先設定
- **設定ページで保存先フォルダを指定可能**
  - 相対パスで指定（例: `TabToMD` または `Documents/TabToMD`）
  - 絶対パスは使用不可
  - デフォルト値: `TabToMD`
- **設定した保存先に自動保存**（フォルダ選択ダイアログは表示しない）

### 3. 保存機能（3種類）

#### 3.1 個別保存ボタン（各タブに表示）
- **機能**: 各タブの右側に「保存」ボタンを表示（ホバー時のみ表示）
- **動作**: クリックでそのタブのみを保存
- **保存場所の記憶**: 前回保存した場所を記憶し、次回も同じ場所に保存
  - 前回の保存場所が無い場合は、設定で指定した保存先を使用

#### 3.2 「1ファイルずつ保存」ボタン
- **機能**: 選択したタブを順番に1つずつ保存
- **動作**: 
  - 選択したタブを順次処理して個別ファイルとして保存
  - 各ファイルは別々のファイルとして保存される
- **保存場所の記憶**: 前回保存した場所を記憶し、次回も同じ場所に保存
  - 前回の保存場所が無い場合は、設定で指定した保存先を使用

（ユーザー要望により一括保存機能は削除）

### 4. UI要件
- **シンプルで使いやすいUI**
- **タブ一覧表示**: 
  - チェックボックスでタブを選択
  - タブのタイトルとURLを表示
  - 各タブに個別保存ボタン（ホバー時表示）
- **操作ボタン**:
  - 「全て選択」ボタン
  - 「全て解除」ボタン
  - 「1ファイルずつ保存」ボタン
  - 「一括で保存」ボタン
- **設定ボタン**: ポップアップ右上の⚙️ボタンから設定ページへ

### 5. 技術要件
- **Manifest V3** 対応
- **必要な権限**:
  - `tabs`: タブ情報の取得
  - `storage`: 設定の保存
  - `downloads`: ファイルのダウンロード
  - `scripting`: ページ内容の取得
  - `host_permissions`: 全URLへのアクセス

### 6. その他
- **エラーハンドリング**: 
  - 一部のサイト（chrome:// など）では内容を取得できない場合がある
  - エラー時は適切なメッセージを表示
- **保存場所の記憶**: 
  - `chrome.storage.local` に前回の保存場所を保存
  - 個別保存と「1ファイルずつ保存」で使用

## 実装済み機能

✅ 基本機能
- タブ一覧の表示
- タブの選択機能
- マークダウン変換機能
- ファイル保存機能

✅ 保存機能
- 個別保存ボタン（各タブに表示）
- 「1ファイルずつ保存」ボタン
- 「一括で保存」ボタン
- 前回の保存場所の記憶機能

✅ 設定機能
- 保存先フォルダの設定
- 設定の保存・読み込み

✅ UI/UX
- シンプルなUI
- 進捗表示
- ステータスメッセージ表示

## 確認済み事項

✅ **保存先の動作**
   - 設定で指定した保存先に自動保存（フォルダ選択ダイアログなし）
   - **確認済み: OK**

✅ **「1ファイルずつ保存」と「一括で保存」の違い**
   - どちらも個別ファイルとして保存
   - **確認済み: OK**

✅ **ファイル名の重複処理**
   - 同じタイトルの場合は `_1`, `_2` と番号を付与
   - **確認済み: OK**

✅ **保存場所の記憶**
   - 個別保存と「1ファイルずつ保存」: 前回の保存場所を記憶
   - 「一括で保存」: 設定で指定した保存先を使用
   - **確認済み: OK**

